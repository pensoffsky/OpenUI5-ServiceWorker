<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta charset="UTF-8">    
    
      <script>
      
      fLoadingIndicatorStart = function (sText) {
          var loadingIndicator = document.getElementById("loadingIndicator");
          if(loadingIndicator) {
              loadingIndicator.textContent = sText;      
          }
          nLoadingIndicatorInterval = window.setInterval(function (argument) {
              var loadingIndicator = document.getElementById("loadingIndicator");
              if(loadingIndicator) {
                  loadingIndicator.textContent += ".";
              }
          }, 1000);
      };
      
      fLoadingIndicatorText = function (sText) {
          var loadingIndicator = document.getElementById("loadingIndicator");
          if(loadingIndicator) {
              loadingIndicator.textContent = sText;      
          }
      };
      
      fLoadingIndicatorRemove = function () {
          window.clearInterval(nLoadingIndicatorInterval);
          var loadingIndicator = document.getElementById("loadingIndicator");
          if(loadingIndicator) {
              loadingIndicator.textContent.remove();
          }
      };
      
      //function that gets called when the UI5 resources were loaded
      //and the "app" can be created
      fUI5Loaded = function(){
            sap.ui.getCore().attachInit(function() {
              sap.ui.require([], function(HTML) {
                sap.ui.getCore().getLibraryResourceBundle();
                // no sync requests!
                    // create a mobile app and display page1 initially
                  var app = new sap.m.App("myApp", {
                      initialPage: "page1"
                  });
                  // create the first page
                  var page1 = new sap.m.Page("page1", {
                      title : "Hello World v01",
                      showNavButton : false,
                      content : new sap.m.Button({
                          text : "Go to Page 2",
                          press : function () {
                              // navigate to page2
                              app.to("page2");
                          }
                      })
                  });
                  // create the second page with a back button
                  var page2 = new sap.m.Page("page2", {
                      title : "Hello Page 2",
                      showNavButton : true,
                      navButtonPress : function () {
                          // go back to the previous page
                          app.back();
                      }
                  });
                  // add both pages to the app
                  app.addPage(page1).addPage(page2);
                  
                   //remove the loading indicator div
                  document.getElementById("loadingIndicator").remove();
                  
                  // place the app into the HTML document
                  app.placeAt("content");
              });
            });
        }
      
      
      //function that adds the UI5 bootstrap script tag to the document
      fLoadUI5 = function(){
          fLoadingIndicatorText("Loading UI5 resources...");
          var s, r, t;
          r = false;
          s = document.createElement('script');
          s.type = 'text/javascript';
          s.src = "dist/resources/sap-ui-custom.js";
          s.id = "sap-ui-bootstrap";
          s.setAttribute("data-sap-ui-libs", "sap.m");
          s.setAttribute("data-sap-ui-theme", "sap_hcb");
          s.setAttribute("data-sap-ui-bindingSyntax", "complex");
          s.setAttribute("data-sap-ui-compatVersion", "edge");
          s.setAttribute("data-sap-ui-xx-supportedLanguages", "en");
          s.setAttribute("data-sap-ui-preload", "async");
          s.onload = s.onreadystatechange = function() {
              console.log( this.readyState ); //uncomment this line to see which ready states are called.  
              if (!r && (!this.readyState || this.readyState == 'complete')) {
                  r = true;
                  //change loading indicator text
                  document.getElementById("loadingIndicator").textContent = "Initializing UI5...";
                  fUI5Loaded();
              }
          };
          t = document.getElementsByTagName('script')[0];
          t.parentElement.insertBefore(s, t);
      };
      
      document.addEventListener("DOMContentLoaded", function(event) { 
        fLoadingIndicatorStart("Loading...");
      });
      
      //check if serviceWorker feature is supported by browser
      //if so register the sw.js as serviceWorker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').then(function(registration) {
            // Registration was successful
            console.log('ServiceWorker registration successful with scope: ',    registration.scope);
            //now load the UI5 resources
            fLoadUI5();
        }).catch(function(err) {
            // registration failed
            console.log('ServiceWorker registration failed: ', err);
            //now load the UI5 resources
            fLoadUI5();
        });
    } else {
        //if the browser does not support serviceworker then just load the app
        fLoadUI5();
    }
        
      </script>
  </head>
  <body class="sapUiBody" id="content">
  <div id="loadingIndicator" style="font-size:4rem;"></div>
    </body>
</html>
